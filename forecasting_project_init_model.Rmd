---
title: "Forecasting project"
author: "Maggie Walters"
date: "September 8, 2017"
output: pdf_document
---

```{r set-up, include=FALSE}
install.packages('deSolve')
library(deSolve)


```

```{r function}
model <- function(t, y, parms){
  susceptible <- c(y[1], y[4], y[7], y[10])
  infected <- c(y[2], y[5], y[8], y[11])
  recovered <- c(y[3], y[6], y[9], y[12])
  population <- c(susceptible, infected, recovered)
  
  beta <- parms[1]
  gamma <- parms[2]
  sigma <- parms[3]
  mu <- parms[4]
  delta <- parms[5]
  
  dS1 <- -beta * susceptible[1] * sum(infected) + mu * sum(population) - delta * susceptible[1]
  dI1 <- beta * susceptible[1] * sum(infected) - gamma * infected[1] - delta * infected[1]
  dR1 <- gamma * infected[1] - delta * recovered[1] - sigma * recovered[1]
  
  dS2 <- (-3/4) * beta * susceptible[2] * sum(infected) + sigma * recovered[1] - delta * susceptible[2]
  dI2 <- (3/4) * beta * susceptible[2] * sum(infected) - beta * infected[2] - delta * infected[2]
  dR2 <- gamma * infected[2] - sigma * recovered[2] - delta * recovered[2]
  
  dS3 <- (-1/2) * beta * susceptible[3] * sum(infected) + sigma * recovered[2] - delta * susceptible[3]
  dI3 <- (1/2) * beta * susceptible[3] * sum(infected) - gamma * infected[3] - delta * infected[3]
  dR3 <- gamma * infected[3] - sigma * recovered[3] - delta * recovered[3]
  
  dS4 <- (-1/4) * beta * susceptible[4] * sum(infected) + sigma * recovered[3] - delta * susceptible[4]
  dI4 <- (1/4) * beta * susceptible[4] * sum(infected)- gamma * infected[4] - delta * infected[4]
  dR4 <- gamma * infected[4] - delta * recovered[4]
 
   list(c(dS1, dI1, dR1,
         dS2, dI2, dR2,
         dS3, dI3, dR3,
         dS4, dI4, dR4))
}

```

###Notes

* Need to find estimates of parameter values. 
    * Beta: find from the Ferguson et. al paper, setting to 1 to assume that it is endemic. 
    * Gamma: Ferguson et. al paper
    * Sigma: Duration of heterologous protection following natural infection (Ferguson says 1 year)
    * Mu: average human birth rate per day (because rn the time step is by day)
    * Delta: death rate per day x the chance that they were in that class. 
        * Very simply, this could just be the death rate divided by the number of classes there are (12), but I feel like death rate should be higher for the second infection. Also if you have been infected more times, you are more likely to be an older individual, so the death rate is probably higher for these classes. 
* Need to introduce a parameter to represent the vaccination rate times the chance that they are in that specific class. Could most likely make this age-dependent. 
* What are good inital population/condition estimates? 
* Ferguson et. al has proportions of the different serotypes (ranging from 0.81 to 0.85).

```{r initial conditions and parms}
y_init <- c(S1 = 1e6, I1 = 1, R1 = 0,
         S2 = 100, I2 = 0, R2 = 0,
         S3 = 100, I3 = 0, R3 = 0,
         S4 = 100, I4 = 0, R4 = 0)

times <- seq(from = 0, to = 365 * 10, by = .1)

parms <- c(beta = 0.05,
           gamma = 0.25,
           sigma = 1/365,
           mu = 6.02 * 10^-4 / 7,
           delta = 7.167 * 10^-6)
```

```{r run prelim model, include = FALSE}
out <- ode(times = times, y = y_init, func = model, parms = parms)
```

```{r graphs}
{par(mfrow=c(3,1))
plot(out)}

```

